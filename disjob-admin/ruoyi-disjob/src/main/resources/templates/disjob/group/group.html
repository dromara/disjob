<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org" xmlns:shiro="http://www.pollix.at/thymeleaf/shiro">
<head>
  <th:block th:include="include :: header('分组配置')" />
</head>
<body class="gray-bg">

  <div class="container-div">
    <div class="row">
      <div class="col-sm-12 search-collapse">
        <form id="sched-job-form">
          <div class="select-list">
            <ul>
              <li>
                <label>分组名称：</label>
                <input type="text" name="group" />
              </li>
              <li>
                <a class="btn btn-primary btn-rounded btn-sm" onclick="$.table.search()"><i class="fa fa-search"></i>&nbsp;搜索</a>
                <a class="btn btn-warning btn-rounded btn-sm" onclick="$.form.reset()"><i class="fa fa-refresh"></i>&nbsp;重置</a>
              </li>
            </ul>
          </div>
        </form>
      </div>

      <div class="btn-group-sm" id="toolbar" role="group">
        <a class="btn btn-success" onclick="$.operate.add()" shiro:hasPermission="disjob:job:operate">
          <i class="fa fa-plus"></i> 添加
        </a>
        <a class="btn btn-primary single disabled" onclick="$.operate.edit()" shiro:hasPermission="disjob:job:operate">
          <i class="fa fa-edit"></i> 修改
        </a>
      </div>

      <div class="col-sm-12 select-table table-striped">
        <table id="bootstrap-table"></table>
      </div>
    </div>
  </div>

  <th:block th:include="include :: footer" />
  <th:block th:include="include :: bootstrap-table-fixed-columns-js" />
  <script th:inline="javascript">
    var operateFlag = [[${@permission.hasPermi('disjob:job:operate')}]];
    var prefix = ctx + "disjob/group";

    $(function () {
      var options = {
        url: prefix + "/list",
        createUrl: prefix + "/add",
        updateUrl: prefix + "/edit/{id}",
        removeUrl: prefix + "/remove",
        exportUrl: prefix + "/export",
        fixedColumns: true,
        fixedNumber: 2,
        modalName: "分组配置",
        columns: [{
          checkbox: true
        },
        {
          field: 'group',
          title: '分组名称',
          formatter: function (value, row, index) {
            return '<a href="javascript:void(0)" onclick="detail(\'' + value + '\')">' + value + '</a>';
          }
        },
        {
          field: 'supervisorToken',
          title: 'Supervisor Token',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'workerToken',
          title: 'Worker Token',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'userToken',
          title: 'User Token',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'ownUser',
          title: 'Own User',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'devUsers',
          title: 'Dev Users',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'alarmUsers',
          title: 'Alarm Users',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'webHook',
          title: 'Web Hook',
          formatter: function (value, row, index) {
            return $.table.tooltip(value, 19, "open");
          }
        },
        {
          field: 'updatedBy',
          title: '更新人'
        },
        {
          field: 'updatedAt',
          title: '更新时间'
        },
        {
          field: 'createdBy',
          title: '创建人',
          visible: false
        },
        {
          field: 'createdAt',
          title: '创建时间',
          visible: false
        },
        {
          title: '操作',
          align: 'center',
          formatter: function (value, row, index) {
            if (![[${@permission.isPermitted('disjob:job:operate')}]]) {
              return '';
            }

            var actions = [];
            actions.push("<a class='btn btn-danger btn-rounded btn-xs " + operateFlag + "' href='javascript:void(0)' onclick='$.operate.remove(&quot;" + row.jobId + "&quot;)'><i class='fa fa-trash'></i> 删除</a> ");
            actions.push("<a class='btn btn-success btn-rounded btn-xs " + operateFlag + "' href='javascript:void(0)' onclick='$.operate.edit(&quot;" + row.jobId + "&quot;)'><i class='fa fa-edit'></i> 编辑</a> ");
            actions.push("<a class='btn btn-warning btn-rounded btn-xs " + operateFlag + "' href='javascript:void(0)' onclick='copy(&quot;" + row.jobId + "&quot;)'><i class='fa fa-copy'></i> 复制</a> ");
            return '<a tabindex="0" class="btn btn-info btn-rounded btn-xs" role="button" data-container="body" data-placement="left" data-toggle="popover" data-html="true" data-trigger="hover" data-content="' + actions.join('') + '"><i class="fa fa-chevron-circle-right"></i> 操作</a>';
          }
        }]
      };
      $.table.init(options);
    });

    function detail(jobId) {
      var url = prefix + '/detail/' + jobId;
      $.modal.open("调度配置详情", url, null, null, null, ['关闭']);
    }

    function copy(jobId) {
      var url = prefix + '/copy/' + jobId;
      $.modal.open("复制", url);
    }

  </script>

</body>
</html>
